<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo de Integra√ß√£o - Site do Cliente</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .produto {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        .btn-comprar {
            background: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .btn-comprar:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>üõí Exemplo de Integra√ß√£o - Site do Cliente</h1>
    
    <div class="produto">
        <h2>üìö Pix do Milh√£o</h2>
        <p><strong>Pre√ßo:</strong> R$ 97,00</p>
        <p><strong>Descri√ß√£o:</strong> Ebook completo sobre como ganhar dinheiro com PIX</p>
        <button class="btn-comprar" onclick="comprarProduto('Pix do Milh√£o', 97)">Comprar Agora</button>
    </div>

    <div class="produto">
        <h2>üíº Ebook Marketing Digital</h2>
        <p><strong>Pre√ßo:</strong> R$ 47,00</p>
        <p><strong>Descri√ß√£o:</strong> Guia completo de marketing digital</p>
        <button class="btn-comprar" onclick="comprarProduto('Ebook Marketing', 47)">Comprar Agora</button>
    </div>

    <div id="status"></div>

    <script>
        // ‚öôÔ∏è CONFIGURA√á√ïES DA API
        const API_CONFIG = {
            baseUrl: 'https://sua-api-pix.com', // ‚ö†Ô∏è ALTERE AQUI
            endpoints: {
                checkout: '/checkout',
                pagamento: '/gerarpix'
            }
        };

        // üîë CONFIGURA√á√ïES DO CLIENTE
        const CLIENT_CONFIG = {
            token: 'token-do-cliente', // ‚ö†Ô∏è ALTERE AQUI
            name: 'Nome do Cliente',   // ‚ö†Ô∏è ALTERE AQUI
            checkoutUrl: 'https://meusite.com/checkout' // ‚ö†Ô∏è ALTERE AQUI
        };

        // üì¶ PRODUTOS/OFERTAS
        const PRODUTOS = {
            'Pix do Milh√£o': {
                preco: 97,
                checkoutCliente: 'https://meusite.com/checkout-pix-milhao'
            },
            'Ebook Marketing': {
                preco: 47,
                checkoutCliente: 'https://meusite.com/checkout-ebook'
            }
        };

        // üõí FUN√á√ÉO PRINCIPAL DE COMPRA
        async function comprarProduto(nomeProduto, preco) {
            try {
                mostrarStatus('üîÑ Processando compra...', 'info');
                
                // 1Ô∏è‚É£ Obter checkout (sistema 7x3)
                const checkoutUrl = await obterCheckout(nomeProduto, PRODUTOS[nomeProduto].checkoutCliente);
                
                // 2Ô∏è‚É£ Verificar se √© checkout do Paulo ou do cliente
                if (checkoutUrl.includes('sua-api-pix.com') || checkoutUrl.includes('checkout-paulo')) {
                    // Checkout do Paulo - processar com BlackCat
                    await processarPagamentoPaulo(nomeProduto, preco);
                } else {
                    // Checkout do cliente - redirecionar
                    mostrarStatus('‚úÖ Redirecionando para checkout do cliente...', 'success');
                    window.location.href = checkoutUrl;
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao processar compra:', error);
                mostrarStatus('‚ùå Erro ao processar compra: ' + error.message, 'error');
            }
        }

        // üîÑ OBTER CHECKOUT (SISTEMA 7x3)
        async function obterCheckout(offer, clientCheckout) {
            try {
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.checkout}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        checkout: clientCheckout,
                        offer: offer
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const data = await response.json();
                console.log('üîÑ Checkout obtido:', data.checkout);
                return data.checkout;
                
            } catch (error) {
                console.error('‚ùå Erro ao obter checkout:', error);
                // Fallback para checkout do cliente
                return clientCheckout;
            }
        }

        // üí≥ PROCESSAR PAGAMENTO DO PAULO (BLACKCAT)
        async function processarPagamentoPaulo(nomeProduto, preco) {
            try {
                mostrarStatus('üí≥ Processando pagamento com BlackCat...', 'info');
                
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.pagamento}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        credentials: {
                            token: CLIENT_CONFIG.token,
                            name: CLIENT_CONFIG.name
                        },
                        amount: preco,
                        product: {
                            title: nomeProduto
                        },
                        customer: {
                            name: 'Cliente Teste', // ‚ö†Ô∏è Obter do formul√°rio
                            email: 'cliente@teste.com', // ‚ö†Ô∏è Obter do formul√°rio
                            phone: '11999999999', // ‚ö†Ô∏è Obter do formul√°rio
                            document: {
                                type: 'CPF',
                                number: '12345678901' // ‚ö†Ô∏è Obter do formul√°rio
                            }
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const pixData = await response.json();
                console.log('‚úÖ PIX criado:', pixData);
                
                // Redirecionar para p√°gina de pagamento PIX
                mostrarStatus('‚úÖ Redirecionando para pagamento PIX...', 'success');
                // window.location.href = pixData.payment_url; // ‚ö†Ô∏è Ajustar conforme resposta da API
                
            } catch (error) {
                console.error('‚ùå Erro ao processar pagamento:', error);
                throw error;
            }
        }

        // üì± MOSTRAR STATUS
        function mostrarStatus(mensagem, tipo) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${tipo}">${mensagem}</div>`;
        }

        // üîß FUN√á√ÉO DE TESTE (para desenvolvimento)
        async function testarAPI() {
            try {
                mostrarStatus('üß™ Testando conex√£o com API...', 'info');
                
                const response = await fetch(`${API_CONFIG.baseUrl}/checkout`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        checkout: 'https://teste.com/checkout',
                        offer: 'Teste'
                    })
                });
                
                if (response.ok) {
                    mostrarStatus('‚úÖ API funcionando corretamente!', 'success');
                } else {
                    mostrarStatus('‚ùå Erro na API: ' + response.status, 'error');
                }
                
            } catch (error) {
                mostrarStatus('‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        }

        // üöÄ INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Site do cliente carregado');
            console.log('‚öôÔ∏è Configura√ß√µes:', { API_CONFIG, CLIENT_CONFIG, PRODUTOS });
            
            // Testar API automaticamente (opcional)
            // testarAPI();
        });
    </script>

    <!-- üîß BOT√ÉO DE TESTE (remover em produ√ß√£o) -->
    <div style="margin-top: 30px; padding: 20px; background: #e9ecef; border-radius: 5px;">
        <h3>üß™ √Årea de Teste (Desenvolvimento)</h3>
        <button class="btn-comprar" onclick="testarAPI()" style="background: #28a745;">Testar API</button>
        <p><small>Use este bot√£o para testar se a API est√° funcionando corretamente.</small></p>
    </div>

    <!-- üìã INSTRU√á√ïES -->
    <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 5px;">
        <h3>üìã Instru√ß√µes de Configura√ß√£o</h3>
        <ol>
            <li><strong>Alterar URL da API:</strong> Substitua <code>https://sua-api-pix.com</code> pela URL real</li>
            <li><strong>Configurar Token:</strong> Substitua <code>token-do-cliente</code> pelo token real</li>
            <li><strong>Configurar Nome:</strong> Substitua <code>Nome do Cliente</code> pelo nome real</li>
            <li><strong>Configurar Checkouts:</strong> Ajuste as URLs dos checkouts do cliente</li>
            <li><strong>Obter Dados do Cliente:</strong> Implemente formul√°rio para coletar dados reais</li>
        </ol>
    </div>
</body>
</html>

